# Kaiden Remote Support - 精簡決策清單

## 圖例
- ✅ 已決定
- ❓ 待決定
- 💡 建議

---

## 1. 整體架構

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 1.1 | 部署環境 | ✅ | VPS (單機) |
| 1.2 | 通訊協議 | ✅ | REST + WebSocket + JSON |
| 1.3 | 資料庫 | ✅ | PostgreSQL |
| 1.4 | Cloudflare Plan | ✅ | Free |

---

## 2. 網域與 DNS

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 2.1 | 網域結構 | ✅ | `*.kaiden.io` |
| 2.2 | DNS 管理 | ✅ | Cloudflare API 動態管理 |
| 2.3 | **網域名稱** | ❓ | 實際要用的域名？ |

---

## 3. API Server

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 3.1 | 開發語言 | ✅ | Go |
| 3.2 | Web 框架 | ❓ | Gin / Echo / Chi？💡 Gin |

> ORM、API 文件等開發時決定即可

---

## 4. Engineer 認證

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 4.1 | **認證方式** | ❓ | Cloudflare Access / 自建？💡 Cloudflare Access |
| 4.2 | IdP 選擇 | ❓ | Google / GitHub？💡 Google |
| 4.3 | 權限角色 | ❓ | 需要哪些？💡 Admin / Engineer 兩種即可 |

> 簡化：移除 Manager 角色，初版不需要複雜的權限層級

---

## 5. Device 管理

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 5.1 | **Device 認證** | ❓ | API Token / mTLS？💡 API Token |
| 5.2 | Device ID 格式 | ❓ | UUID / 序號？💡 UUID |
| 5.3 | 心跳間隔 | ✅ | 30 秒 |
| 5.4 | 離線判定 | ✅ | 90 秒 |
| 5.5 | Customer 分組 | ❓ | 需要嗎？💡 需要，方便管理 |

---

## 6. Helper App

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 6.1 | 開發語言 | ✅ | Go |
| 6.2 | **同意機制 UI** | ❓ | CLI prompt / GUI 彈窗 / 系統通知？ |
| 6.3 | 支援的 OS | ❓ | 💡 先 Linux only |
| 6.4 | 開機啟動 | ❓ | 💡 systemd service |
| 6.5 | cloudflared | ❓ | 內嵌 / 外部呼叫？💡 外部呼叫 |

> 簡化：移除自動更新（初版手動更新）

---

## 7. Support Request Flow

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 7.1 | 客戶同意 | ✅ | 每次都需同意 |
| 7.2 | 同意超時 | ❓ | 💡 60 秒 |
| 7.3 | 超時處理 | ❓ | 💡 自動取消，工程師可重試 |

> 簡化：移除「拒絕原因記錄」、「冷卻時間」

---

## 8. Session 管理

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 8.1 | Session 模式 | ✅ | 一對一、互斥 |
| 8.2 | 預設時長 | ✅ | 4 小時 |
| 8.3 | 最大時長 | ❓ | 💡 24 小時 |
| 8.4 | 延長機制 | ❓ | 需客戶同意？💡 需要 |

> 簡化：移除整個「Session 接管」功能，初版不需要

---

## 9. Session Container

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 9.1 | 存取方式 | ✅ | Web UI (xterm.js + reverse proxy) |
| 9.2 | 支援服務 | ❓ | 💡 先 SSH + Device Web UI |
| 9.3 | 資源限制 | ❓ | 💡 1 CPU / 512MB |

> 簡化：移除檔案傳輸、VNC/RDP 支援（Phase 2）

---

## 10. Device Tunnel

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 10.1 | Tunnel 驗證 | ✅ | Cloudflare Access + Service Token |
| 10.2 | Tunnel 生命週期 | ❓ | 每次新建 / 重用？💡 每次新建較安全 |

---

## 11. Device Credentials

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 11.1 | SSH 認證 | ✅ | 臨時 SSH Key 注入 |
| 11.2 | Web UI 認證 | ✅ | 預設帳密自動填入 |
| 11.3 | **SSH 帳號權限** | ❓ | sudo / 一般？💡 sudo |
| 11.4 | SSH 帳號名稱 | ❓ | 💡 `kaiden_support` |

> 簡化：密碼加密方式開發時決定

---

## 12. Audit 審計

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 12.1 | 追蹤層級 | ✅ | Session + 指令操作 |
| 12.2 | 保留時間 | ✅ | 90 天 |
| 12.3 | 儲存位置 | ❓ | 💡 PostgreSQL |
| 12.4 | 敏感指令 | ❓ | 需定義列表（rm -rf, reboot 等）|

> 簡化：移除告警通知、報表匯出（Phase 2）

---

## 13. 異常處理

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 13.1 | Engineer 斷線 | ❓ | 💡 保持 Session，10 分鐘未重連自動結束 |
| 13.2 | Device 離線 | ❓ | 💡 通知工程師，5 分鐘未重連結束 Session |
| 13.3 | 清理機制 | ❓ | 💡 定時任務清理殘留資源 |

> 簡化：Cloudflare API 重試等用標準策略即可

---

## 14. 部署

| # | 決策項目 | 狀態 | 決定/選項 |
|---|----------|------|-----------|
| 14.1 | CI/CD | ❓ | 💡 GitHub Actions |
| 14.2 | 備份策略 | ❓ | 💡 每日 DB 備份 |

> 簡化：監控、Log 管理初版用基本方案

---

## 統計

| 狀態 | 數量 |
|------|------|
| ✅ 已決定 | 18 |
| ❓ 待決定 | **25** |

（原本 91 項 → 精簡為 43 項，待決定從 65 項降至 25 項）

---

## 🔴 必須先決定（開發前）

| # | 項目 | 建議 |
|---|------|------|
| 2.3 | 網域名稱 | 確認實際域名 |
| 4.1 | Engineer 認證方式 | Cloudflare Access |
| 5.1 | Device 認證方式 | API Token |
| 6.2 | Helper App 同意 UI | **需討論** |
| 11.3 | SSH 帳號權限 | sudo |

---

## 移除的項目說明

### 前端相關（實現細節）
- 前端框架選擇 (Vue/React)
- UI 元件庫
- 即時更新方式 (WebSocket/SSE)
- 多語言支援
- Web Terminal 實現

### 過度設計
- Session 接管/強制接管功能
- Manager 角色
- 多種通知管道 (Email/Slack)
- IP 白名單
- Session 錄影
- 檔案傳輸
- 報表匯出
- Key 輪換

### 可開發時決定
- ORM 選擇
- API 文件工具
- 密碼加密算法
- Container 基礎 Image
- 具體資源限制數值
